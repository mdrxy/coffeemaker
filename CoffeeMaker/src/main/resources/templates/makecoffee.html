<!DOCTYPE HTML>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
	<head>
		<!-- Standard Meta -->
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

		<!-- Site Properties -->
		<title>Make Coffee</title>

		<script src="js/jquery.js"></script>
		<link rel="stylesheet" type="text/css" href="css/semantic.css">
		<script src="js/semantic.js"></script>
		<script src="js/app.js"></script>
		<link rel="stylesheet" href="css/app.css" />
		<script src="https://tildesites.bowdoin.edu/~k.preslermarshall/AngularJS/angular.min.js"></script>
	</head>

	<body>
		<!-- Modal templates -->
		<div th:insert="modals :: modals"></div>

		<!-- Page layout -->
		<div layout:fragment="content" class="generic-container ng-cloak" ng-app="myApp" ng-controller="recipesCtrl">
			<div class="wrapper">
				<div class="content">
					<div class="ui grid container">
						<div class="column">
							<h1 class="ui centered header">Make Coffee</h1>

							<!-- Recipe list -->
							<div>
								<ul>
									<li ng-repeat="recipe in recipes">
										<label>{{recipe.name | capitalize}}
											<input type="radio" ng-model="$parent.name" name="name" value="{{recipe.name}}"
												required="true" />
										</label>
									</li>
								</ul>
							</div>

							<!-- Control -->
							<!-- Don't show if no Recipes exist, instead show a link to make a new one -->
							<!-- Modal? -->
							<div>
								<label for="amtPaid">Enter payment</label>
								<input type="text" ng-model="amtPaid" name="amtPaid" required="true" />
								<input type="submit" ng-click="make()" value="Make Coffee" class="btn btn-primary btn-sm" />

								<div ng-show="submissionSuccess" class="success">Coffee was made. Your change is {{change}}.
								</div>
								<div ng-show="submissionFailure">An error occurred: {{error}}</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<footer class="ui bottom fixed borderless menu">
			<div class="item">
				<div class="spaced buttons">
					<div th:insert="footerLinks :: pages"></div>
				</div>
			</div>

			<div class="right menu">
				<div class="item">
					<div th:insert="footerLinks :: homePage"></div>
				</div>
			</div>
		</footer>

		<script th:inline="javascript">
			/*<![CDATA[*/

			var app = angular.module('myApp', []);
			app.filter('capitalize', function () {
				return function (input) {
					if (input) {
						return input.charAt(0).toUpperCase() + input.substr(1).toLowerCase();
					}
				};
			})
			app.controller('recipesCtrl', function ($scope, $http, $q) {
				$http.get("/api/v1/recipes").then(function (response) {
					$scope.recipes = response.data;
				});

				$scope.make = function () {
					var amtPaid = $scope.amtPaid;
					var name = $scope.name;
					$scope.submissionFailure = false;
					$scope.submissionSuccess = false;
					$http.post("/api/v1/makecoffee/" + name, amtPaid).then(
						function (response) {
							$scope.change = response.data.message;
							$scope.submissionSuccess = true;
						}, function (errResponse) {
							console.log(errResponse);
							$scope.submissionFailure = true;
							$scope.error = "Error while making recipe";
						});
				}
			});

			/*]]>*/
		</script>
	</body>
</html>