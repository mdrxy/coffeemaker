<!DOCTYPE HTML>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
	<head>
		<!-- Standard Meta -->
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

		<!-- Site Properties -->
		<title>Delete Recipes</title>

		<script src="js/jquery.js"></script>
		<link rel="stylesheet" type="text/css" href="css/semantic.css">
		<script src="js/semantic.js"></script>
		<script src="js/app.js"></script>
		<link rel="stylesheet" href="css/app.css" />
		<script src="https://tildesites.bowdoin.edu/~k.preslermarshall/AngularJS/angular.min.js"></script>
	</head>

	<body>
		<!-- Modal templates -->
		<div th:insert="modals :: modals"></div>

		<!-- Page layout -->
		<div layout:fragment="content" class="generic-container ng-cloak" ng-app="myApp" ng-controller="recipesCtrl as ctrl">
			<div class="wrapper">
				<div class="content">
					<div class="ui grid container">
						<div class="column">
							<h1 class="ui centered header">Delete Recipe</h1>

							<!-- Recipe list -->
							<div>
								<ul>
									<li ng-repeat="recipe in recipes">
										<label>{{recipe.name | capitalize}}
											<input type="radio" ng-model="$parent.name" name="name" value="{{recipe.name}}"
												required="true" />
										</label>
									</li>
								</ul>
							</div>

							<!-- Control -->
							<div>
								<div ng-if="recipes.length > 0">
									<input type="checkbox" name="all" class="checkbox" ng-model="$parent.deleteAll">Delete
									all recipes?</input>
									<input type="submit" value="Delete" ng-click="del()" class="btn btn-warning btn-sm" />
								</div>

								<div ng-if="0 >= recipes.length">
									<p>There are no recipes in the Coffee Maker. <a href="customrecipe.html">Add one?</a>
									</p>
								</div>
								<div ng-if="submissionSuccess">Recipe deleted successfully</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<footer class="ui bottom fixed borderless menu">
			<div class="item">
				<div class="spaced buttons">
					<div th:insert="footerLinks :: pages"></div>
				</div>
			</div>

			<div class="right menu">
				<div class="item">
					<div th:insert="footerLinks :: homePage"></div>
				</div>
			</div>
		</footer>

		<script>
			/*<![CDATA[*/

			var app = angular.module('myApp', []);
			app.filter('capitalize', function () {
				return function (input) {
					if (input) {
						return input.charAt(0).toUpperCase() + input.substr(1).toLowerCase();
					}
				};
			})
			app.controller('recipesCtrl', function ($scope, $http) {

				function updateRecipes() {
					$http.get("/api/v1/recipes").then(function (response) {
						$scope.recipes = response.data;
					});
				}

				function deleteRecipe(recipe) {
					$http.delete("/api/v1/recipes/" + recipe)
						.then(
							function (response) {
								console.log(response);
								$scope.submissionSuccess = true;


								updateRecipes();
							},
							function (rejection) {
								console.error('Error while deleting recipe');
								console.log(rejection);

								$scope.submissionSuccess = false;

								// Update recipe list
								$http.get("/api/v1/recipes").then(function (response) {
									$scope.recipes = response.data;
								});
							}
						);
				}

				$scope.del = function () {
					if ($scope.deleteAll) {
						for (var i = 0, len = $scope.recipes.length; i < len; i++) {
							var recipe = $scope.recipes[i];
							deleteRecipe(recipe.name);
						}
					} else {
						deleteRecipe($scope.name);
					}

					updateRecipes();
				}

				updateRecipes();
			});

			/*]]>*/
		</script>
	</body>

</html>